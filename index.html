<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crypto 20x Perps Simulator + Indicators</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #0e0e12;
      color: #ffd700;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      text-align: center;
    }
    .buttons button,
    .trade-panel button,
    .timeframe button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      border-radius: 5px;
      background: #1b1b26;
      border: 2px solid #ffd700;
      color: #ffd700;
    }
    .buttons button.active,
    .timeframe button.active {
      background: #ffd700;
      color: #000;
    }
    .signal-boxes, .indicators-boxes {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    .signal, .indicator-status {
      padding: 15px;
      border-radius: 8px;
      border: 2px solid #ffd700;
      min-width: 200px;
      background-color: #1b1b26;
    }
    .signal h3, .indicator-status h3 {
      margin-bottom: 5px;
    }
    .info {
      font-size: 0.8em;
      color: #aaa;
    }
    .output, .history-table {
      margin-top: 30px;
    }
    table {
      margin: auto;
      color: #ffd700;
      border-collapse: collapse;
      width: 80%;
    }
    table, th, td {
      border: 1px solid #ffd700;
      padding: 8px;
    }
    canvas {
      max-width: 800px;
      margin-top: 30px;
    }
    iframe {
      width: 100%;
      height: 500px;
      border: none;
      margin-top: 20px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <h1>ðŸš€ 20x Crypto Perpetuals Trading Simulator</h1>
  <div class="buttons">
    <button onclick="selectAsset('BTCUSDT')" class="active">â‚¿ Bitcoin</button>
    <button onclick="selectAsset('ETHUSDT')">Îž Ethereum</button>
    <button onclick="selectAsset('SOLUSDT')">â—Ž Solana</button>
  </div>
  <div class="timeframe">
    <button onclick="setTimeframe('4h')" class="active">4H</button>
    <button onclick="setTimeframe('1d')">1D</button>
    <button onclick="setTimeframe('1w')">1W</button>
    <button onclick="setTimeframe('1m')">1M</button>
  </div>
  <div class="price-display">
    <p>Current Price: <span id="price">Loading...</span></p>
    <div class="signal-boxes">
      <div class="signal">
        <h3>ðŸ“ˆ Long Signal <span title="How likely it is based on indicators that a long trade is favorable.">ðŸ›ˆ</span></h3>
        <div id="longStrength">0%</div>
      </div>
      <div class="signal">
        <h3>ðŸ“‰ Short Signal <span title="How likely it is based on indicators that a short trade is favorable.">ðŸ›ˆ</span></h3>
        <div id="shortStrength">0%</div>
      </div>
    </div>
  </div>
  <div class="indicators-boxes">
    <div class="indicator-status">
      <h3>RSI <span title="Relative Strength Index â€” identifies overbought/oversold.">ðŸ›ˆ</span></h3>
      <div id="rsiIndicator">Calculating...</div>
    </div>
    <div class="indicator-status">
      <h3>MACD <span title="Moving Average Convergence Divergence â€” shows trend strength.">ðŸ›ˆ</span></h3>
      <div id="macdIndicator">Calculating...</div>
    </div>
    <div class="indicator-status">
      <h3>VWAP <span title="Volume Weighted Average Price â€” identifies mean reversion.">ðŸ›ˆ</span></h3>
      <div id="vwapIndicator">Calculating...</div>
    </div>
  </div>
  <div id="tradingview-container">
    <iframe id="tvChart" src=""></iframe>
  </div>
  <div class="trade-panel">
    <button onclick="enterTrade('long')">Execute Long</button>
    <button onclick="enterTrade('short')">Execute Short</button>
    <button onclick="exitTrade()">Exit</button>
  </div>
  <div class="output" id="status">
    Balance: $<span id="balance">1000.00</span><br>
    Position: <span id="position">None</span><br>
    PnL: <span id="pnl">$0.00</span>
  </div>
  <canvas id="tradeChart"></canvas>
  <div class="history-table">
    <h3>ðŸ“œ Trade History</h3>
    <table>
      <thead><tr><th>Time</th><th>Type</th><th>Entry</th><th>Exit</th><th>PnL</th></tr></thead>
      <tbody id="historyBody"></tbody>
    </table>
  </div>
  <script>
    let asset = 'BTCUSDT';
    let timeframe = '4h';
    let price = 0;
    let balance = 1000;
    let position = null;
    let entryPrice = 0;
    const leverage = 20;
    let chart;

    function setupChart() {
      const ctx = document.getElementById('tradeChart').getContext('2d');
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [
            {
              label: 'Price',
              data: [],
              borderColor: '#ffd700',
              borderWidth: 2,
              pointRadius: 0
            },
            {
              label: 'Trades',
              data: [],
              pointBackgroundColor: [],
              pointRadius: 6,
              type: 'scatter',
              showLine: false
            }
          ]
        },
        options: { scales: { x: { display: false } } }
      });
    }

    function updateTradingView() {
      const tvURL = `https://s.tradingview.com/widgetembed/?symbol=BINANCE:${asset}&interval=${timeframe.toUpperCase()}&theme=dark&style=1&studies=["IchimokuCloud","MACD4C","RodizRSIEMA","Stochastic","TrendSupportBand","VPVR"]`;
      document.getElementById('tvChart').src = tvURL;
    }

    async function fetchPrice() {
      try {
        const res = await fetch(`https://fapi.binance.com/fapi/v1/ticker/price?symbol=${asset}`);
        const data = await res.json();
        price = parseFloat(data.price);
        document.getElementById('price').innerText = '$' + price.toFixed(2);
        const now = new Date().toLocaleTimeString();
        chart.data.labels.push(now);
        chart.data.datasets[0].data.push(price);
        if (chart.data.labels.length > 30) {
          chart.data.labels.shift();
          chart.data.datasets[0].data.shift();
        }
        chart.update();
        calculateSignals();
        updatePnL();
      } catch (err) {
        document.getElementById('price').innerText = 'Error';
        console.error('Price fetch error:', err);
      }
    }

    function calculateSignals() {
      const rsi = 50 + (Math.random() * 50 - 25);
      const macd = Math.random() * 2 - 1;
      const vwapTrend = Math.random() > 0.5;
      document.getElementById('rsiIndicator').innerText = rsi.toFixed(1) + (rsi < 40 ? ' âžœ Long' : rsi > 60 ? ' âžœ Short' : ' âžœ Neutral');
      document.getElementById('macdIndicator').innerText = macd.toFixed(2) + (macd > 0 ? ' âžœ Long' : macd < 0 ? ' âžœ Short' : ' âžœ Neutral');
      document.getElementById('vwapIndicator').innerText = vwapTrend ? 'Above âžœ Long' : 'Below âžœ Short';
      const longScore = (rsi < 40 ? 30 : 0) + (macd > 0 ? 35 : 0) + (vwapTrend ? 35 : 0);
      const shortScore = (rsi > 60 ? 30 : 0) + (macd < 0 ? 35 : 0) + (!vwapTrend ? 35 : 0);
      document.getElementById('longStrength').innerText = `${longScore}%`;
      document.getElementById('shortStrength').innerText = `${shortScore}%`;
    }

    function enterTrade(type) {
      if (position) return alert('Close the current position first.');
      position = type;
      entryPrice = price;
      chart.data.datasets[1].data.push({ x: chart.data.labels[chart.data.labels.length - 1], y: price });
      chart.data.datasets[1].pointBackgroundColor.push(type === 'long' ? 'lime' : 'red');
      chart.update();
      updateStatus();
    }

    function exitTrade() {
      if (!position) return;
      const size = (balance / entryPrice) * leverage;
      const pnl = (price - entryPrice) * size * (position === 'long' ? 1 : -1);
      balance += pnl;
      addToHistory(position, entryPrice, price, pnl);
      position = null;
      entryPrice = 0;
      updateStatus();
    }

    function updatePnL() {
      if (!position) {
        document.getElementById('pnl').innerText = '$0.00';
        return;
      }
      const size = (balance / entryPrice) * leverage;
      const pnl = (price - entryPrice) * size * (position === 'long' ? 1 : -1);
      document.getElementById('pnl').innerText = '$' + pnl.toFixed(2);
    }

    function updateStatus() {
      document.getElementById('balance').innerText = balance.toFixed(2);
      document.getElementById('position').innerText = position ? `${position.toUpperCase()} @ $${entryPrice.toFixed(2)}` : 'None';
      updatePnL();
    }

    function addToHistory(type, entry, exit, pnl) {
      const row = `<tr><td>${new Date().toLocaleTimeString()}</td><td>${type.toUpperCase()}</td><td>$${entry.toFixed(2)}</td><td>$${exit.toFixed(2)}</td><td>$${pnl.toFixed(2)}</td></tr>`;
      document.getElementById('historyBody').innerHTML += row;
    }

    function selectAsset(sym) {
      asset = sym;
      document.querySelectorAll('.buttons button').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.buttons button[onclick*="${sym}"]`).classList.add('active');
      updateTradingView();
      fetchPrice();
    }

    function setTimeframe(tf) {
      timeframe = tf;
      document.querySelectorAll('.timeframe button').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.timeframe button[onclick*="${tf}"]`).classList.add('active');
      updateTradingView();
    }

    window.onload = () => {
      setupChart();
      updateTradingView();
      fetchPrice();
      setInterval(fetchPrice, 5000);
    };
  </script>
</body>
</html>
