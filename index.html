<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crypto 20x Perps Simulator + Indicators</title>
  <style>
    :root {
      color-scheme: light dark;
    }
    body {
      background-color: #0e0e12;
      color: #ffd700;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      text-align: center;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    @media (prefers-color-scheme: light) {
      body {
        background-color: #f2f2f2;
        color: #111;
      }
      .buttons button,
      .trade-panel button {
        background-color: #fff;
        border: 2px solid #222;
        color: #111;
      }
    }
    .buttons button,
    .trade-panel button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      border-radius: 5px;
      background: #1b1b26;
      border: 2px solid #ffd700;
      color: #ffd700;
    }
    .buttons button.active {
      background: #ffd700;
      color: #000;
    }
    .trade-panel, .output, .indicators {
      margin-top: 30px;
    }
    .iframe-container {
      margin-top: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    iframe {
      border: none;
      border-radius: 10px;
      width: 100%;
      height: 350px;
    }
  </style>
</head>
<body>
  <h1>üöÄ 20x Crypto Perpetuals Trading Simulator</h1>

  <div class="buttons">
    <button onclick="selectAsset('BTCUSDT')" class="active">‚Çø Bitcoin</button>
    <button onclick="selectAsset('ETHUSDT')">Œû Ethereum</button>
    <button onclick="selectAsset('SOLUSDT')">‚óé Solana</button>
  </div>

  <div class="price-display">
    <p>Current Price: <span id="price">Loading...</span></p>
    <p><strong>Signal:</strong> <span id="signal">Loading...</span></p>
  </div>

  <div class="trade-panel">
    <button onclick="enterTrade('long')">üìà Long x20</button>
    <button onclick="enterTrade('short')">üìâ Short x20</button>
    <button onclick="exitTrade()">‚ùå Exit</button>
  </div>

  <div class="output" id="status">
    Balance: $<span id="balance">1000.00</span><br>
    Position: <span id="position">None</span><br>
    PnL: <span id="pnl">$0.00</span>
  </div>

  <div class="indicators">
    <h2>üîç Market Indicators (TradingView)</h2>
    <p>Use these indicators to help confirm entry/exit points:</p>
    <div class="iframe-container">
      <iframe src="https://www.tradingview.com/embed-widget/advanced-chart/?symbol=BINANCE:BTCUSDT&interval=15&theme=dark&style=1&locale=en&studies=[\"P1bybHZA\",\"4IYKX938\",\"6d61aahI\",\"rxQe55S2\",\"jSJLz1F2\",\"yLEjeo0J\"]"></iframe>
    </div>
    <p>
      <strong>üü¢ Long Setup:</strong> Bullish divergence + RSI oversold + MACD crossover + Price above VWAP<br>
      <strong>üî¥ Short Setup:</strong> Bearish divergence + RSI overbought + MACD down crossover + Price below VWAP<br>
      <strong>‚ö†Ô∏è Close:</strong> Opposite signals appear or trend momentum weakens
    </p>
  </div>

  <script>
    let asset = 'BTCUSDT';
    let price = 0;
    let balance = 1000;
    let position = null;
    let entryPrice = 0;
    const leverage = 20;

    async function fetchPrice() {
      try {
        const res = await fetch(`https://fapi.binance.com/fapi/v1/ticker/price?symbol=${asset}`);
        const data = await res.json();
        price = parseFloat(data.price);
        document.getElementById('price').innerText = '$' + price.toFixed(2);
        updatePnL();
        updateSignal();
      } catch (err) {
        document.getElementById('price').innerText = 'Error';
      }
    }

    async function updateSignal() {
      const prevPrice = sessionStorage.getItem('prevPrice') || price;
      const change = ((price - prevPrice) / prevPrice) * 100;
      let signal = 'Neutral';
      if (change > 0.3) signal = 'Long Bias';
      else if (change < -0.3) signal = 'Short Bias';
      document.getElementById('signal').innerText = signal;
      sessionStorage.setItem('prevPrice', price);
    }

    function selectAsset(sym) {
      asset = sym;
      document.querySelectorAll('.buttons button').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.buttons button[onclick*="${sym}"]`).classList.add('active');
      resetTrade();
      fetchPrice();
    }

    function enterTrade(type) {
      if (position) return alert('Close existing position first');
      position = type;
      entryPrice = price;
      updateStatus();
    }

    function exitTrade() {
      if (!position) return;
      const size = (balance / entryPrice) * leverage;
      const pnl = (price - entryPrice) * size * (position === 'long' ? 1 : -1);
      balance += pnl;
      resetTrade();
    }

    function resetTrade() {
      position = null;
      entryPrice = 0;
      updateStatus();
    }

    function updatePnL() {
      if (!position) {
        document.getElementById('pnl').innerText = '$0.00';
        return;
      }
      const size = (balance / entryPrice) * leverage;
      const pnl = (price - entryPrice) * size * (position === 'long' ? 1 : -1);
      document.getElementById('pnl').innerText = '$' + pnl.toFixed(2);
    }

    function updateStatus() {
      document.getElementById('balance').innerText = balance.toFixed(2);
      document.getElementById('position').innerText = position ? `${position.toUpperCase()} @ $${entryPrice.toFixed(2)}` : 'None';
      updatePnL();
    }

    setInterval(fetchPrice, 5000);
    fetchPrice();
  </script>
</body>
</html>
